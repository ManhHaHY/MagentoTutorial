<h1 id="rsync-over-ssh-with-key-authentication">Rsync over SSH with key authentication</h1>
<p>Using rsync and ssh to synchronize folders over the network.</p>
<h2 id="setup-the-ssh-login-with-key-authentication">Setup the SSH login with key authentication</h2>
<p>Create a new ssh key pair:</p>
<!-- language: lang-sh -->

<pre><code>ssh-keygen -t rsa -b 2048 -f andy-rsync-key</code></pre>
<p>Move the public(!) key to the remote server:</p>
<!-- language: lang-sh -->

<pre><code>scp andy-rsync-key.pub andy@magento-azure.cloudapp.net:/home/andy/</code></pre>
<p>Append the public key to the &quot;authorized_keys&quot; on your remote server:</p>
<!-- language: lang-sh -->

<pre><code>ssh -l andy magento-azure.cloudapp.net
cat andy-rsync-key.pub &gt;&gt; .ssh/authorized_keys</code></pre>
<p>Test the connection:</p>
<!-- language: lang-sh -->

<pre><code>ssh -l andy -i ~/.ssh/andy-rsync-key magento-azure.cloudapp.net</code></pre>
<p>You should not be prompted for a password.</p>
<h2 id="setup-the-folder-synchronization">Setup the folder synchronization</h2>
<p>Test the synchronization:</p>
<!-- language: lang-sh -->

<pre><code>rsync --progress -avz -e &quot;ssh -i /home/dev/.ssh/andy-rsync-key&quot; /home/dev/git-master/ andy@magento-azure.cloudapp.net:/home/andy/git-master/</code></pre>
<p>Create a shell script for the synchronization</p>
<!-- language: lang-sh -->

<pre><code>vi ~/bin/sync-git-master.sh</code></pre>
<blockquote>
<p><code>#!/bin/bash</code> rsync --progress -avz --delete -e &quot;ssh -i /home/dev/.ssh/andy-rsync-key&quot; /home/dev/git-master/ andy@magento-azure.cloudapp.net:/home/andy/git-master/</p>
</blockquote>
<pre><code>chmod 700 ~/bin/sync-git-master.sh</code></pre>
<p>Schedule the script execution (every 5 minutes):</p>
<!-- language: lang-sh -->

<pre><code>crontab -e</code></pre>
<blockquote>
<p>`# m h dom mon dow command */5 * * * * /home/dev/bin/git-master-sync.sh</p>
</blockquote>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://help.ubuntu.com/community/rsync">Ubuntu Community: rsync</a></li>
<li><a href="http://troy.jdmz.net/rsync/index.html">Using Rsync and SSH - Keys, Validation and Automation</a></li>
<li><a href="http://www.linuxproblem.org/art_9.html">SSH login without password</a></li>
<li><a href="http://www.thegeekstuff.com/2011/07/cron-every-5-minutes/">The Geek Stuff: How to Run Cron Every 5 Minutes, Seconds, Hours, Days, Months</a></li>
</ul>
<hr />
<p>language: en date: 2013-01-17 tags: Linux, Backup, SSH</p>
